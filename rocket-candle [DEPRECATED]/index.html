<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <link rel="icon" type="image/svg+xml" href="/vite.svg" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>üöÄ Rocket Candle: Monad Edition</title>
    <link rel="stylesheet" type="text/css" href="/css/landing.css" />
  </head>
  <body>
    <!-- Floating Rockets Background -->
    <div class="floating-rockets">
      <div class="floating-rocket">üöÄ</div>
      <div class="floating-rocket">üöÄ</div>
      <div class="floating-rocket">üöÄ</div>
      <div class="floating-rocket">üöÄ</div>
      <div class="floating-candle">üïØÔ∏è</div>
      <div class="floating-candle">üïØÔ∏è</div>
      <div class="floating-candle">üïØÔ∏è</div>
      <div class="floating-candle">üïØÔ∏è</div>
    </div>

    <!-- Landing Page -->
    <div id="landing" class="landing-container">
      <section class="hero-section; margin-bottom: 0px;">
        <div class="monad-logo">M</div>
        <h1 class="hero-title">üöÄ Rocket Candle</h1>
        <p class="hero-subtitle">
          Blast through candlestick barriers and earn FUEL tokens on the Monad
          blockchain! Master physics-based gameplay in this revolutionary Web3
          gaming experience.
        </p>
      </section>

      <section class="cta-section">
        <!-- Wallet Connection Section -->
        <div id="wallet-section" class="wallet-section">
          <button
            id="connect-wallet-btn"
            class="play-button"
            onclick="connectWallet()"
          >
            üîí Connect Wallet
          </button>

          <!-- Network Status -->
          <div id="network-status" class="network-status hidden">
            <div class="network-warning">
              <h4>‚ö†Ô∏è Wrong Network Detected</h4>
              <p>Please switch to <strong>Monad Testnet</strong> to continue</p>
              <button
                id="switch-network-btn"
                onclick="switchNetwork()"
                class="switch-network-btn"
              >
                üîÑ Switch to Monad Testnet
              </button>
            </div>
          </div>

          <div class="wallet-info">
            <p><strong>üîí Connect your wallet to:</strong></p>
            <p>
              ‚Ä¢ Save scores on-chain<br />
              ‚Ä¢ Earn FUEL tokens<br />
              ‚Ä¢ Access leaderboards
            </p>
            <p>
              <small
                >Supports MetaMask and WalletConnect on Monad Testnet</small
              >
            </p>
          </div>
        </div>

        <!-- Dashboard Section (hidden initially) -->
        <div id="dashboard-section" class="dashboard-section">
          <button class="play-button" onclick="startGame()">
            üöÄ Start Playing
          </button>
          <div class="wallet-connected-info">
            <div class="info-card wallet-status">
              <h3>üîó Wallet Connected</h3>
              <p id="wallet-address">Address: Loading...</p>
              <p id="fuel-balance">FUEL Balance: Loading...</p>
              <p id="network-info" class="network-info">
                Network: Monad Testnet ‚úÖ
              </p>
            </div>

            <div class="info-card leaderboard-container">
              <h3>üèÜ Leaderboard</h3>
              <div id="leaderboard-list">
                <div class="loading-state">
                  <div class="loading-spinner"></div>
                  <p>Loading leaderboard...</p>
                </div>
              </div>
            </div>

            <div class="info-card player-stats">
              <h3>üìä Your Stats</h3>
              <div id="player-scores">
                <div class="loading-state">
                  <div class="loading-spinner"></div>
                  <p>Loading your stats...</p>
                </div>
              </div>
            </div>
          </div>

          <!-- <button class="play-button" onclick="startGame()">
            üöÄ Start Playing
          </button> -->
        </div>
      </section>

      <section class="content-section">
        <div class="features">
          <div class="feature-card">
            <div class="feature-icon">üéØ</div>
            <div class="feature-title">Physics Puzzle Game</div>
            <p>
              Master trajectory and timing to destroy enemies hidden in market
              data structures.
            </p>
          </div>

          <div class="feature-card">
            <div class="feature-icon">üìà</div>
            <div class="feature-title">Market-Based Levels</div>
            <p>
              Navigate through 7 procedurally generated levels based on
              candlestick patterns.
            </p>
          </div>

          <div class="feature-card">
            <div class="feature-icon">üîó</div>
            <div class="feature-title">Blockchain Integration</div>
            <p>
              Scores stored on Monad blockchain with FUEL token rewards for
              achievements.
            </p>
          </div>

          <div class="feature-card">
            <div class="feature-icon">üèÜ</div>
            <div class="feature-title">Compete & Earn</div>
            <p>
              Climb the leaderboard and earn rewards for your gameplay skills.
            </p>
          </div>
        </div>
      </section>

      <footer class="footer">
        <p>Developed at Monad Blitz üíú</p>
        <p>
          <a
            href="https://github.com/ironicdegawd"
            target="_blank"
            rel="noopener noreferrer"
          >
            github.com/ironicdegawd
          </a>
        </p>
      </footer>
    </div>

    <!-- Game Container -->
    <div id="game-container" class="game-container">
      <!-- Game Navigation Header -->
      <div class="game-header">
        <button class="back-to-landing-btn" onclick="backToLanding()">
          ‚Üê Back to Main Menu
        </button>
        <div class="game-title">üöÄ Rocket Candle</div>
      </div>
      
      <div id="app"></div>

      <!-- Game Information Panels - Below the game -->
      <div id="game-info-panels" class="game-info-panels">
        <!-- Game Mechanics Panel -->
        <div id="game-mechanics" class="game-mechanics-panel">
          <div class="mechanics-container">
            <h3>üéÆ Game Controls & Mechanics</h3>
            <div class="mechanics-grid">
              <div class="control-section">
                <h4>üéØ Controls</h4>
                <div class="control-item">
                  <img
                    src="assets/buttons/w.png"
                    alt="W key"
                    class="key-icon small-key"
                  />
                  <img
                    src="assets/buttons/s.png"
                    alt="S key"
                    class="key-icon small-key"
                  />
                  <span class="key-description">Angle Adjustment</span>
                </div>
                <div class="control-item">
                  <img
                    src="assets/buttons/a.png"
                    alt="A key"
                    class="key-icon small-key"
                  />
                  <img
                    src="assets/buttons/d.png"
                    alt="D key"
                    class="key-icon small-key"
                  />
                  <span class="key-description">Power Adjustment</span>
                </div>
                <div class="control-item">
                  <img
                    src="assets/buttons/space.png"
                    alt="Space key"
                    class="key-icon space-key small-space"
                  />
                  <span class="key-description">Launch Rocket</span>
                </div>
              </div>
              <div class="targets-section">
                <h4>üéØ Targets & Obstacles</h4>
                <div class="target-item">
                  <img
                    src="assets/enemies/var1.png"
                    alt="Enemy"
                    class="target-icon small-sprite"
                  />
                  <span class="target-description"
                    >Enemy Characters - Destroy these to win!</span
                  >
                </div>
                <div class="target-item">
                  <img
                    src="assets/blocks/greencandle.png"
                    alt="Green barrier"
                    class="target-icon small-sprite"
                  />
                  <img
                    src="assets/blocks/redcandle.png"
                    alt="Red barrier"
                    class="target-icon small-sprite"
                  />
                  <span class="target-description"
                    >Candlestick Barriers - Avoid or navigate around</span
                  >
                </div>
                <div class="target-item">
                  <img
                    src="assets/blocks/dest.png"
                    alt="Destructible block"
                    class="target-icon small-sprite"
                  />
                  <span class="target-description"
                    >Destructible Blocks - Can be destroyed</span
                  >
                </div>
              </div>
            </div>
            <div class="tip-section">
              <p>
                üí° <strong>Tip:</strong> Use the angle and power sliders or
                keyboard controls to aim precisely. You have limited attempts
                per level!
              </p>
            </div>
          </div>
        </div>

        <!-- Leaderboard Panel -->
        <div id="game-leaderboard" class="game-leaderboard-panel">
          <div class="leaderboard-container-game">
            <h3>üèÜ Global Leaderboard</h3>
            <div class="leaderboard-content">
              <div id="game-leaderboard-list" class="leaderboard-list-game">
                <div class="loading-state-game">
                  <div class="loading-spinner-game"></div>
                  <p>Loading leaderboard...</p>
                </div>
              </div>
            </div>
            <div class="leaderboard-stats">
              <div class="stat-item-game">
                <span class="stat-label">Your Best Score</span>
                <span id="player-best-score" class="stat-value">--</span>
              </div>
              <div class="stat-item-game">
                <span class="stat-label">Global Best</span>
                <span id="global-best-score" class="stat-value">--</span>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <script type="module">
      import { walletManager } from "./src/services/WalletManager.js";
      import { web3Service } from "./src/services/Web3Service.js";

      let isWalletConnected = false;
      let connectedAddress = null;
      let isCorrectNetwork = false;

      // Initialize wallet services
      async function initializeWalletServices() {
        try {
          console.log("üîÑ Initializing wallet services...");

          // Load connection state from session storage
          const savedConnectionState = loadConnectionState();
          if (savedConnectionState) {
            console.log(
              "üì¶ Found saved connection state:",
              savedConnectionState
            );
          }

          // Use the singleton walletManager instance

          // Set up connection change handler
          walletManager.onConnectionChange = (isConnected, address) => {
            isWalletConnected = isConnected;
            connectedAddress = address;

            if (isConnected) {
              web3Service.setWallet(address);
              // Save connection state
              saveConnectionState({
                isConnected,
                address,
                timestamp: Date.now(),
              });
            } else {
              // Clear saved state on disconnect
              clearConnectionState();
            }

            updateUIState();

            if (isConnected) {
              loadDashboardData();
            }
          };

          // Set up network change handler
          walletManager.onNetworkStatusChange = (networkValid, chainId) => {
            isCorrectNetwork = networkValid;
            updateNetworkStatus(networkValid, chainId);
            updateUIState();

            // Update saved state
            if (connectedAddress) {
              saveConnectionState({
                isConnected: isWalletConnected,
                address: connectedAddress,
                isCorrectNetwork: networkValid,
                timestamp: Date.now(),
              });
            }
          };

          // Check if wallet is already connected
          if (
            walletManager.checkConnection &&
            typeof walletManager.checkConnection === "function"
          ) {
            const isAlreadyConnected = await walletManager.checkConnection();
            if (isAlreadyConnected) {
              isWalletConnected = true;
              connectedAddress = walletManager.address;
              isCorrectNetwork = walletManager.isCorrectNetwork;
              web3Service.setWallet(connectedAddress);
              updateUIState();
              loadDashboardData();
            } else if (
              walletManager.address &&
              !walletManager.isCorrectNetwork
            ) {
              // Wallet is connected but wrong network
              connectedAddress = walletManager.address;
              isCorrectNetwork = false;
              updateNetworkStatus(false, walletManager.currentChainId);
              updateUIState();
            } else if (savedConnectionState && savedConnectionState.address) {
              // Try to reconnect based on saved state
              console.log("üîÑ Attempting to restore connection...");
              try {
                await walletManager.checkConnection();
              } catch (error) {
                console.log("Failed to restore connection:", error);
                clearConnectionState();
              }
            }
          }

          console.log("‚úÖ Wallet services initialized");
        } catch (error) {
          console.error("‚ùå Failed to initialize wallet services:", error);
        }
      }

      // Connection state persistence functions
      function saveConnectionState(state) {
        try {
          sessionStorage.setItem(
            "walletConnectionState",
            JSON.stringify(state)
          );
          console.log("üíæ Connection state saved:", state);
        } catch (error) {
          console.warn("Failed to save connection state:", error);
        }
      }

      function loadConnectionState() {
        try {
          const saved = sessionStorage.getItem("walletConnectionState");
          if (saved) {
            const state = JSON.parse(saved);
            // Check if state is not too old (max 1 hour)
            if (Date.now() - state.timestamp < 3600000) {
              return state;
            } else {
              console.log("üïê Saved connection state expired, clearing...");
              clearConnectionState();
            }
          }
        } catch (error) {
          console.warn("Failed to load connection state:", error);
        }
        return null;
      }

      function clearConnectionState() {
        try {
          sessionStorage.removeItem("walletConnectionState");
          console.log("üóëÔ∏è Connection state cleared");
        } catch (error) {
          console.warn("Failed to clear connection state:", error);
        }
      }

      // Update UI based on wallet connection state
      function updateUIState() {
        const walletSection = document.getElementById("wallet-section");
        const dashboardSection = document.getElementById("dashboard-section");

        console.log("üîÑ Updating UI state:", {
          isWalletConnected,
          connectedAddress,
          isCorrectNetwork,
        });

        if (isWalletConnected && connectedAddress && isCorrectNetwork) {
          walletSection.style.display = "none";
          dashboardSection.classList.remove("hidden");
          dashboardSection.classList.add("flex");

          // Update wallet info
          const shortAddress = `${connectedAddress.slice(
            0,
            6
          )}...${connectedAddress.slice(-4)}`;
          document.getElementById(
            "wallet-address"
          ).textContent = `Address: ${shortAddress}`;

          // Update network info
          const networkInfo = document.getElementById("network-info");
          if (networkInfo) {
            networkInfo.textContent = "Network: Monad Testnet ‚úÖ";
            networkInfo.className = "network-info network-correct";
          }

          // Hide network error if showing
          hideNetworkError();

          // Update game leaderboard if it's visible
          const gameLeaderboard = document.getElementById("game-leaderboard");
          if (
            gameLeaderboard &&
            window.getComputedStyle(gameLeaderboard).display !== "none"
          ) {
            loadGameLeaderboard();
          }

          // Force refresh of any game-related UI components
          refreshAllGameComponents();
        } else {
          walletSection.style.display = "flex";
          dashboardSection.classList.add("hidden");
          dashboardSection.classList.remove("flex");

          // Show network error if connected but wrong network
          if (connectedAddress && !isCorrectNetwork) {
            showNetworkError();
          } else {
            hideNetworkError();
          }
        }
      }

      // Refresh all game components function
      function refreshAllGameComponents() {
        console.log("üîÑ Refreshing all game components...");

        // Refresh connection status indicators
        updateConnectionStatusIndicators();

        // Refresh play button status
        updatePlayButtonStatus();

        // Refresh network status
        updateNetworkStatusIndicators();

        // Refresh leaderboards if visible
        if (isWalletConnected && connectedAddress) {
          loadDashboardData();
        }

        console.log("‚úÖ All game components refreshed");
      }

      // Update connection status indicators throughout the page
      function updateConnectionStatusIndicators() {
        const indicators = document.querySelectorAll(
          ".wallet-status-indicator"
        );
        indicators.forEach((indicator) => {
          if (isWalletConnected) {
            indicator.textContent = "üü¢ Connected";
            indicator.className = "wallet-status-indicator connected";
          } else {
            indicator.textContent = "üî¥ Not Connected";
            indicator.className = "wallet-status-indicator disconnected";
          }
        });
      }

      // Update play button status based on wallet connection
      function updatePlayButtonStatus() {
        const playButtons = document.querySelectorAll(
          '.play-button, [onclick="startGame()"]'
        );
        playButtons.forEach((button) => {
          if (isWalletConnected && isCorrectNetwork) {
            button.disabled = false;
            button.style.opacity = "1";
            button.style.cursor = "pointer";
            if (button.textContent.includes("WALLET NOT CONNECTED")) {
              button.textContent = "üöÄ Start Playing";
            }
          } else {
            button.disabled = true;
            button.style.opacity = "0.5";
            button.style.cursor = "not-allowed";
            if (!isWalletConnected) {
              button.textContent = "WALLET NOT CONNECTED";
            } else if (!isCorrectNetwork) {
              button.textContent = "WRONG NETWORK";
            }
          }
        });
      }

      // Update network status indicators
      function updateNetworkStatusIndicators() {
        const networkIndicators = document.querySelectorAll(
          ".network-status-indicator"
        );
        networkIndicators.forEach((indicator) => {
          if (isCorrectNetwork) {
            indicator.textContent = "üü¢ Monad Testnet";
            indicator.className = "network-status-indicator correct";
          } else if (connectedAddress) {
            indicator.textContent = "üü° Wrong Network";
            indicator.className = "network-status-indicator wrong";
          } else {
            indicator.textContent = "üî¥ Not Connected";
            indicator.className = "network-status-indicator disconnected";
          }
        });
      }

      // Connect wallet function
      async function connectWallet() {
        const connectBtn = document.getElementById("connect-wallet-btn");
        const originalText = connectBtn.textContent;

        // Show loading state
        connectBtn.textContent = "üîÑ Connecting...";
        connectBtn.classList.add("connecting");
        connectBtn.disabled = true;

        try {
          if (!walletManager) {
            throw new Error("Wallet manager not initialized");
          }

          // Show detailed progress
          connectBtn.textContent = "üîÑ Checking network...";

          // Connect wallet using WalletManager (this now includes network validation)
          await walletManager.connectWallet();

          console.log("‚úÖ Wallet connected successfully");
          connectBtn.textContent = "‚úÖ Connected!";
          connectBtn.classList.add("success-glow");

          // Force UI refresh after successful connection
          setTimeout(() => {
            updateUIState();
            refreshAllGameComponents();
          }, 100);

          // UI will be updated via the onConnectionChange callback
        } catch (error) {
          console.error("‚ùå Wallet connection failed:", error);
          connectBtn.textContent = "‚ùå Connection Failed";
          connectBtn.classList.remove("connecting");

          // Show user-friendly error message
          let errorMessage = "Failed to connect wallet";
          if (error.message.includes("not available")) {
            errorMessage = "Please install MetaMask or another Web3 wallet";
          } else if (error.message.includes("rejected")) {
            errorMessage = "Connection rejected by user";
          } else if (error.message.includes("pending")) {
            errorMessage = "Please check your wallet for pending requests";
          } else if (
            error.message.includes("network") ||
            error.message.includes("chain") ||
            error.message.includes("Network")
          ) {
            errorMessage = error.message; // Use the specific network error message
            // Show network switch UI
            showNetworkError();
          }

          // Show error with timeout
          setTimeout(() => {
            connectBtn.textContent = originalText;
            connectBtn.disabled = false;
            if (
              !error.message.includes("network") &&
              !error.message.includes("chain") &&
              !error.message.includes("Network")
            ) {
              alert(errorMessage);
            }
          }, 2000);
        } finally {
          // Ensure button is re-enabled after delay
          setTimeout(() => {
            connectBtn.disabled = false;
            connectBtn.classList.remove("connecting");
            if (connectBtn.textContent.includes("Failed")) {
              connectBtn.textContent = originalText;
            }
          }, 3000);
        }
      }

      // Switch network function
      async function switchNetwork() {
        const switchBtn = document.getElementById("switch-network-btn");
        const originalText = switchBtn.textContent;
        switchBtn.textContent = "üîÑ Switching...";
        switchBtn.disabled = true;

        try {
          const success = await walletManager.switchToMonadNetwork();
          if (success) {
            console.log("‚úÖ Network switched successfully");
            hideNetworkError();
            // Try to connect again
            if (walletManager.address && !isWalletConnected) {
              setTimeout(connectWallet, 1000);
            }
          } else {
            throw new Error("Failed to switch network");
          }
        } catch (error) {
          console.error("‚ùå Network switch failed:", error);
          alert(
            "Failed to switch to Monad Testnet. Please switch manually in your wallet."
          );
        } finally {
          switchBtn.textContent = originalText;
          switchBtn.disabled = false;
        }
      }

      // Update UI based on wallet connection state
      function updateUIState() {
        const walletSection = document.getElementById("wallet-section");
        const dashboardSection = document.getElementById("dashboard-section");

        console.log("üîÑ Updating UI state:", {
          isWalletConnected,
          connectedAddress,
          isCorrectNetwork,
        });

        if (isWalletConnected && connectedAddress && isCorrectNetwork) {
          walletSection.style.display = "none";
          dashboardSection.classList.remove("hidden");
          dashboardSection.classList.add("flex");

          // Update wallet info
          const shortAddress = `${connectedAddress.slice(
            0,
            6
          )}...${connectedAddress.slice(-4)}`;
          document.getElementById(
            "wallet-address"
          ).textContent = `Address: ${shortAddress}`;

          // Update network info
          const networkInfo = document.getElementById("network-info");
          if (networkInfo) {
            networkInfo.textContent = "Network: Monad Testnet ‚úÖ";
            networkInfo.className = "network-info network-correct";
          }

          // Hide network error if showing
          hideNetworkError();

          // Update game leaderboard if it's visible
          const gameLeaderboard = document.getElementById("game-leaderboard");
          if (
            gameLeaderboard &&
            window.getComputedStyle(gameLeaderboard).display !== "none"
          ) {
            loadGameLeaderboard();
          }

          // Force refresh of any game-related UI components
          refreshAllGameComponents();
        } else {
          walletSection.style.display = "flex";
          dashboardSection.classList.add("hidden");
          dashboardSection.classList.remove("flex");

          // Show network error if connected but wrong network
          if (connectedAddress && !isCorrectNetwork) {
            showNetworkError();
          } else {
            hideNetworkError();
          }
        }
      }

      // === GAME LEADERBOARD FUNCTIONS ===

      // Display leaderboard for game view
      function displayGameLeaderboard(leaderboard) {
        const leaderboardList = document.getElementById(
          "game-leaderboard-list"
        );
        const playerBestScore = document.getElementById("player-best-score");
        const globalBestScore = document.getElementById("global-best-score");

        if (!leaderboard || leaderboard.length === 0) {
          leaderboardList.innerHTML =
            '<div class="loading-state-game"><p>No scores available</p><p>Play to be the first!</p></div>';
          globalBestScore.textContent = "--";
          playerBestScore.textContent = "--";
          return;
        }

        // Update global best score
        globalBestScore.textContent =
          leaderboard[0]?.score?.toLocaleString() || "--";

        // Find player's best score
        let playerBest = "--";
        if (connectedAddress) {
          const playerEntry = leaderboard.find(
            (entry) =>
              entry.player.toLowerCase() === connectedAddress.toLowerCase()
          );
          if (playerEntry) {
            playerBest = playerEntry.score.toLocaleString();
          }
        }
        playerBestScore.textContent = playerBest;

        // Display top 10 entries
        const topEntries = leaderboard.slice(0, 10);
        const leaderboardHTML = topEntries
          .map((entry, index) => {
            const rank = index + 1;
            const shortAddress = `${entry.player.slice(
              0,
              6
            )}...${entry.player.slice(-4)}`;

            // Highlight current player
            const isCurrentPlayer =
              connectedAddress &&
              entry.player.toLowerCase() === connectedAddress.toLowerCase();
            const itemClass = isCurrentPlayer
              ? "leaderboard-item-game current-player"
              : "leaderboard-item-game";

            return `
              <div class="${itemClass}">
                <div class="leaderboard-info-game">
                  <span class="leaderboard-rank-game">#${rank}</span>
                  <span class="leaderboard-address-game mono">${shortAddress}${
              isCurrentPlayer ? " (You)" : ""
            }</span>
                </div>
                <span class="leaderboard-score-game">${entry.score.toLocaleString()}</span>
              </div>
            `;
          })
          .join("");

        leaderboardList.innerHTML = leaderboardHTML;
      }

      // Load leaderboard for game view
      async function loadGameLeaderboard() {
        try {
          console.log("üèÜ Loading game leaderboard...");
          const leaderboardData = await loadLeaderboard();
          console.log("üèÜ Leaderboard data received:", leaderboardData);
          displayGameLeaderboard(leaderboardData);
        } catch (error) {
          console.error("Failed to load game leaderboard:", error);
          displayGameLeaderboard([]);
        }
      }

      // Refresh game leaderboard (can be called from game)
      function refreshGameLeaderboard() {
        if (isWalletConnected) {
          loadGameLeaderboard();
        }
      }

      // === MISSING FUNCTION IMPLEMENTATIONS ===

      // Start game function - handles game container visibility
      function startGame() {
        console.log("üöÄ Starting game...");
        
        if (!isWalletConnected || !connectedAddress || !isCorrectNetwork) {
          console.warn("‚ö†Ô∏è Cannot start game: Wallet not ready");
          alert("Please connect your wallet to Monad Testnet first!");
          return;
        }

        // Hide landing page
        document.getElementById("landing").style.display = "none";
        
        // Show game container with mechanics and leaderboard
        document.getElementById("game-container").style.display = "block";
        document.getElementById("game-info-panels").style.display = "flex";
        
        // Initialize game leaderboard
        loadGameLeaderboard();
        
        console.log("‚úÖ Game container displayed, starting Phaser game...");
      }

      // Load dashboard data function
      async function loadDashboardData() {
        console.log("üìä Loading dashboard data...");
        
        if (!isWalletConnected || !connectedAddress) {
          console.warn("‚ö†Ô∏è Cannot load dashboard: Wallet not connected");
          return;
        }

        try {
          // Load leaderboard data
          await loadGameLeaderboard();
          
          // Update wallet info display
          const walletAddress = document.getElementById("wallet-address");
          if (walletAddress) {
            const shortAddress = `${connectedAddress.slice(0, 6)}...${connectedAddress.slice(-4)}`;
            walletAddress.textContent = `Address: ${shortAddress}`;
          }
          
          console.log("‚úÖ Dashboard data loaded successfully");
        } catch (error) {
          console.error("‚ùå Failed to load dashboard data:", error);
        }
      }

      // Load leaderboard function
      async function loadLeaderboard() {
        console.log("üèÜ Loading leaderboard from backend...");
        
        try {
          // This should call the backend service to get leaderboard data
          // For now, return mock data structure that matches expected format
          const mockLeaderboard = [
            { player: connectedAddress || "0x1234...5678", score: 1000 },
            { player: "0x9876...4321", score: 850 },
            { player: "0xabcd...efgh", score: 720 }
          ];
          
          console.log("‚úÖ Leaderboard loaded:", mockLeaderboard);
          return mockLeaderboard;
        } catch (error) {
          console.error("‚ùå Failed to load leaderboard:", error);
          return [];
        }
      }

      // Show network error function
      function showNetworkError() {
        console.log("üö® Showing network error");
        
        const networkStatus = document.getElementById("network-status");
        if (networkStatus) {
          networkStatus.innerHTML = `
            <div class="network-error">
              <span>‚ùå Wrong Network</span>
              <button id="switch-network-btn" onclick="switchNetwork()">Switch to Monad Testnet</button>
            </div>
          `;
          networkStatus.classList.remove("hidden");
        }
      }

      // Hide network error function
      function hideNetworkError() {
        console.log("‚úÖ Hiding network error");
        
        const networkStatus = document.getElementById("network-status");
        if (networkStatus) {
          networkStatus.classList.add("hidden");
          networkStatus.innerHTML = "";
        }
      }

      // Back to landing function (for game navigation)
      function backToLanding() {
        console.log("üîô Returning to landing page...");
        
        // Hide game container
        document.getElementById("game-container").style.display = "none";
        document.getElementById("game-info-panels").style.display = "none";
        
        // Show landing page
        document.getElementById("landing").style.display = "block";
        
        console.log("‚úÖ Returned to landing page");
      }

      // Initialize wallet services when page loads
      document.addEventListener("DOMContentLoaded", () => {
        initializeWalletServices();
      });

      // Make functions globally available for HTML onclick handlers
      window.connectWallet = connectWallet;
      window.switchNetwork = switchNetwork;
      window.startGame = startGame;
      window.refreshGameLeaderboard = refreshGameLeaderboard;
      window.loadGameLeaderboard = loadGameLeaderboard;
      window.backToLanding = backToLanding;
    </script>
  </body>
</html>
